<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Método de Pagamento - CuidaFast</title>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../CSS/styles.css" />
  <link rel="stylesheet" href="../CSS/pages/homeCliente.css">
  <link rel="stylesheet" href="../CSS/pages/pagamentoopcao.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="client-home">
  <!-- Header Moderno -->
  <header class="modern-header">
      <div class="header-container">
          <!-- Logo Section -->
          <div class="header-left">
              <a href="homeCliente.html" class="logo-link">
                  <img id="logo" src="../assets/Logotipo_1_vetorizado.svg" alt="Logotipo CuidaFast" class="logo" />
                  <span class="logo-text"></span>
              </a>
          </div>
          
          <!-- Espaço Central Vazio -->
          <div class="header-center">
          </div>
          
          <!-- User Actions -->
          <div class="header-right">
              <!-- Notifications -->
              <button class="header-action-btn notification-btn active" id="notificationBtn">
                  <i class="ph ph-bell"></i>
                  <span class="notification-badge" style="display: none;">0</span>
              </button>
              
              <!-- Messages -->
              <button class="header-action-btn message-btn" id="messageBtn">
                  <i class="ph ph-chat-circle"></i>
                  <span class="message-badge" style="display: none;">0</span>
              </button>
              
              <!-- User Profile -->
              <div class="user-profile-dropdown" id="userProfileDropdown">
                  <button class="user-profile-btn" id="userProfileBtn">
                      <img src="../assets/pascoal.png" alt="Avatar do usuário" class="user-avatar-img" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\'%3E%3Ccircle cx=\'20\' cy=\'20\' r=\'18\' fill=\'%234CAF50\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\' fill=\'white\' font-size=\'16\'%3E%3C/text%3E%3C/svg%3E'">
                      <span class="user-name" id="headerUserName">Cliente</span>
                      <i class="ph ph-caret-down dropdown-arrow"></i>
                  </button>
                  
                  <!-- Dropdown Menu -->
                  <div class="profile-dropdown-menu" id="profileDropdownMenu">
                      <div class="dropdown-header">
                          <img src="../assets/pascoal.png" alt="Avatar" class="dropdown-avatar" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\'%3E%3Ccircle cx=\'20\' cy=\'20\' r=\'18\' fill=\'%234CAF50\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\' fill=\'white\' font-size=\'16\'%3E%3C/text%3E%3C/svg%3E'">
                          <div class="dropdown-user-info">
                              <h4 id="dropdownUserName">Cliente</h4>
                              <p>Conta Cliente</p>
                          </div>
                      </div>
                      <div class="dropdown-divider"></div>
                      <a href="#" class="dropdown-item">
                          <i class="ph ph-user"></i>
                          <span>Meu Perfil</span>
                      </a>
                      <a href="../HTML/configuracoes.html" class="dropdown-item">
                          <i class="ph ph-gear"></i>
                          <span>Configurações</span>
                      </a>
                      <a href="#" class="dropdown-item">
                          <i class="ph ph-clock"></i>
                          <span>Histórico</span>
                      </a>
                      <a href="#" class="dropdown-item">
                          <i class="ph ph-question"></i>
                          <span>Ajuda</span>
                      </a>
                      <div class="dropdown-divider"></div>
                      <a href="../../index.html" class="dropdown-item logout-item" id="headerLogoutBtn">
                          <i class="ph ph-sign-out"></i>
                          <span>Sair</span>
                      </a>
                  </div>
              </div>
              
              <!-- Mobile Menu Toggle -->
              <button class="mobile-menu-toggle" id="mobileMenuToggle">
                  <i class="ph ph-list"></i>
              </button>
          </div>
      </div>
      
  </header>

  <div class="main-container">
    <!-- Conteúdo Principal Centralizado -->
    <div class="main-content">

      <div class="payment-card-centered">
        <div class="back">
        <a href="javascript:history.back()" class="back-link">
          <i class="ph ph-arrow-circle-left"></i>
        </a>
      </div>
        <div class="card-header">
          <h3 style="color: var(--azul-escuro); text-align: center;">Método de Pagamento</h3>
        </div>
        <!-- Botões de Método de Pagamento -->
<div class="payment-options">
  <ul class="payment-options-list">
    <li>
      <label class="payment-option">
        <div class="option-left">
          <input type="radio" name="payment" value="pix" class="payment-radio">
          <div class="option-icon">
            <i class="ph ph-currency-circle-dollar"></i>
          </div>
          <div class="option-details">
            <h3>Pix</h3>
            <p>Transferência rápida e segura</p>
          </div>
        </div>
        <i class="ph ph-caret-right option-arrow"></i>
      </label>
    </li>

    <li>
      <label class="payment-option">
        <div class="option-left">
          <input type="radio" name="payment" value="pagseguro" class="payment-radio">
          <div class="option-icon">
            <i class="ph ph-credit-card"></i>
          </div>
          <div class="option-details">
            <h3>PagSeguro</h3>
            <p>Cartões, boletos e parcelamentos</p>
          </div>
        </div>
        <i class="ph ph-caret-right option-arrow"></i>
      </label>
    </li>
  </ul>
</div>


<button type="button" class="btn-continue" id="btnContinuePayment">Continuar</button>
      </div>
    </div>

    <!-- Linha Separadora Vertical -->
    <div class="vertical-separator"></div>

    <!-- Sidebar do Resumo da Compra -->
    <aside class="summary-sidebar">
      <div class="summary-content">
        <h2 style="color: var(--azul-escuro); margin-bottom: 1.5rem;">Resumo da compra</h2>
        <div class="summary-item">
          <span style="color: var(--azul-escuro);">Serviço</span>
          <span style="color: var(--azul-escuro); font-weight: 600;">R$95<sup>00</sup></span>
        </div>
        <hr style="border-color: var(--azul-escuro); opacity: 0.3; margin: 1rem 0;">
        <div class="summary-item total">
          <span style="color: var(--azul-escuro); font-weight: 700;">Você pagará</span>
          <span style="color: var(--azul-escuro); font-weight: 700; font-size: 1.25rem;" id="totalPagamento">R$95<sup>00</sup></span>
        </div>
      </div>
    </aside>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../JS/main.js"></script>
  <script src="../JS/header.js"></script>
  
  <script src="../JS/auth.js"></script>
  <script>
   // Carregar valor do cuidador
   document.addEventListener('DOMContentLoaded', async function() {
     try {
       // Buscar ID do cuidador da URL ou localStorage
       const urlParams = new URLSearchParams(window.location.search);
       const cuidadorId = urlParams.get('cuidadorId') || localStorage.getItem('cuidafast_contratacao_cuidadorId');
       
       if (cuidadorId) {
         const response = await fetch(`/api/perfil/cuidadores?action=cuidador&id=${encodeURIComponent(cuidadorId)}`);
         if (response.ok) {
           const cuidador = await response.json();
           const valorHora = cuidador.valor_hora || cuidador.valorHora || 95.00;
           
           // Atualizar resumo
           document.querySelector('.summary-item span:last-child').textContent = `R$${valorHora.toFixed(2).replace('.', ',')}`;
           document.getElementById('totalPagamento').innerHTML = `R$${valorHora.toFixed(2).replace('.', ',')}`;
           
           // Salvar valor para uso no pagamento
           localStorage.setItem('cuidafast_pagamento_valor', valorHora.toString());
         }
       } else {
         // Usar valor padrão se não encontrar cuidador
         const valorPadrao = 95.00;
         localStorage.setItem('cuidafast_pagamento_valor', valorPadrao.toString());
       }
     } catch (error) {
       console.error('[PagamentoOpcao] Erro ao carregar valor:', error);
       const valorPadrao = 95.00;
       localStorage.setItem('cuidafast_pagamento_valor', valorPadrao.toString());
     }
   });

  // Fluxo atual: somente redireciona para a tela de PIX (Mercado Pago fica guardado abaixo)
  document.getElementById("btnContinuePayment").addEventListener("click", () => {
    const metodo = document.querySelector("input[name='payment']:checked");
  
    if (!metodo) {
      alert("Selecione um método de pagamento");
      return;
    }
  
    const valor = parseFloat(localStorage.getItem('cuidafast_pagamento_valor') || '95.00');
    // guardar método/valor para as próximas telas, se precisar
    localStorage.setItem('cuidafast_pagamento_metodo', metodo.value);
    localStorage.setItem('cuidafast_pagamento_valor', valor.toString());
  
    if (metodo.value === 'pix') {
      // Vai para a página de pagamento PIX
      window.location.href = 'pagamentopix.html';
    } else {
      // Futuro: aqui poderemos reativar o fluxo de mercado pago/pagseguro
      alert('No momento apenas pagamento via PIX está disponível. Em breve outras opções.');
    }
  });

  // ===== CÓDIGO ANTIGO DO MERCADO PAGO (GUARDADO) =====
  // Mantido aqui caso você queira reativar o fluxo direto com a API depois.
  async function criarPagamentoMercadoPago(body) {
    try {
      console.log("[Pagamento][MercadoPago] Enviando requisição:", body);
      const res = await fetch("/api/pagamento/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      console.log("[Pagamento][MercadoPago] Status da resposta:", res.status, res.statusText);
      console.log("[Pagamento][MercadoPago] Content-Type:", res.headers.get("content-type"));

      const responseText = await res.text();
      console.log("[Pagamento][MercadoPago] Resposta (texto):", responseText.substring(0, 500));

      let json;
      const contentType = res.headers.get("content-type");
      if (contentType && contentType.includes("application/json")) {
        try {
          json = JSON.parse(responseText);
        } catch (parseError) {
          console.error("[Pagamento][MercadoPago] Erro ao parsear JSON:", parseError);
          console.error("[Pagamento][MercadoPago] Resposta completa:", responseText);
          throw new Error(`Resposta inválida do servidor (${res.status})`);
        }
      } else {
        console.error("[Pagamento][MercadoPago] Resposta não é JSON. Content-Type:", contentType);
        console.error("[Pagamento][MercadoPago] Resposta completa:", responseText);
        throw new Error(`Servidor retornou resposta inválida (${res.status})`);
      }

      if (!res.ok) {
        console.error("[Pagamento][MercadoPago] Erro do servidor:", json);
        const errorMsg = json.error || json.message || "Erro ao criar pagamento";
        throw new Error(errorMsg);
      }

      return json;
    } catch (err) {
      console.error("[Pagamento][MercadoPago] Erro na requisição:", err);
      throw err;
    }
  }


  </script>
</body>
</html>
