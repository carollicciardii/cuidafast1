<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enviar Documentos - CuidaFast</title>
  <link rel="stylesheet" href="../CSS/pages/enviardocumentoscuidador.css">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    .file-preview {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(27, 71, 93, 0.05);
      border-radius: 8px;
      display: none;
      align-items: center;
      gap: 1rem;
    }
    
    .file-preview.show {
      display: flex;
    }
    
    .file-preview-icon {
      font-size: 2.5rem;
      color: var(--azul-escuro);
    }
    
    .file-preview-info {
      flex: 1;
    }
    
    .file-preview-name {
      font-weight: 600;
      color: var(--azul-escuro);
      margin-bottom: 0.25rem;
    }
    
    .file-preview-size {
      font-size: 0.85rem;
      color: #666;
    }
    
    .file-preview-remove {
      background: none;
      border: none;
      color: #e74c3c;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    .file-preview-remove:hover {
      background: rgba(231, 76, 60, 0.1);
      transform: scale(1.1);
    }
    
    .file-preview-image {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid var(--azul-escuro);
    }
    
    .upload-status {
      margin-top: 0.5rem;
      padding: 0.5rem;
      border-radius: 6px;
      font-size: 0.9rem;
      display: none;
    }
    
    .upload-status.success {
      background: rgba(46, 204, 113, 0.1);
      color: #27ae60;
      display: block;
    }
    
    .upload-status.error {
      background: rgba(231, 76, 60, 0.1);
      color: #e74c3c;
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="back">
      <a href="cadastrocuidadortipo.html" class="back-link">
        <i class="ph ph-arrow-circle-left"></i>
      </a>
    </div>
    <h1>Cadastre-se</h1>
    <h2>Documentos Necessários</h2>

    <!-- Upload RG/CNH (Documento de Identidade) -->
    <div class="upload-box">
      <p><strong>RG ou CNH</strong><br>Arquivo em PDF ou imagem (máx. 5MB)</p>
      <label class="upload-btn">
        <i class="ph ph-upload"></i> Fazer Upload
        <input type="file" accept=".pdf,.jpg,.jpeg,.png" id="rg-cnh">
      </label>
      <div class="upload-status" id="status-rg"></div>
      <div class="file-preview" id="preview-rg">
        <img class="file-preview-image" id="img-rg" style="display:none;">
        <i class="ph ph-file-pdf file-preview-icon" id="icon-rg"></i>
        <div class="file-preview-info">
          <div class="file-preview-name" id="name-rg"></div>
          <div class="file-preview-size" id="size-rg"></div>
        </div>
        <button class="file-preview-remove" id="remove-rg" type="button">
          <i class="ph ph-x-circle"></i>
        </button>
      </div>
    </div>

    <!-- Upload Certificados de cursos e experiência comprovada -->
    <div class="upload-box">
      <p><strong>Certificados de cursos e experiência comprovada</strong><br>Certificados, declarações ou documentos que comprovem sua formação e experiência (PDF ou imagem, máx. 5MB cada)</p>
      <label class="upload-btn">
        <i class="ph ph-upload"></i> Fazer Upload
        <input type="file" accept=".pdf,.jpg,.jpeg,.png" id="certificados" multiple>
      </label>
      <div class="upload-status" id="status-certificados"></div>
      <div class="file-preview" id="preview-certificados">
        <img class="file-preview-image" id="img-certificados" style="display:none;">
        <i class="ph ph-file-pdf file-preview-icon" id="icon-certificados"></i>
        <div class="file-preview-info">
          <div class="file-preview-name" id="name-certificados"></div>
          <div class="file-preview-size" id="size-certificados"></div>
        </div>
        <button class="file-preview-remove" id="remove-certificados" type="button">
          <i class="ph ph-x-circle"></i>
        </button>
      </div>
    </div>

    <!-- Upload Feedback (avaliações de clientes) -->
    <div class="upload-box">
      <p><strong>Feedbacks / Avaliações de clientes</strong><br>Avaliações, prints ou cartas de recomendação de clientes (PDF ou imagem, máx. 5MB cada)</p>
      <label class="upload-btn">
        <i class="ph ph-upload"></i> Fazer Upload
        <input type="file" accept=".pdf,.jpg,.jpeg,.png" id="feedback" multiple>
      </label>
      <div class="upload-status" id="status-feedback"></div>
      <div class="file-preview" id="preview-feedback">
        <img class="file-preview-image" id="img-feedback" style="display:none;">
        <i class="ph ph-file-pdf file-preview-icon" id="icon-feedback"></i>
        <div class="file-preview-info">
          <div class="file-preview-name" id="name-feedback"></div>
          <div class="file-preview-size" id="size-feedback"></div>
        </div>
        <button class="file-preview-remove" id="remove-feedback" type="button">
          <i class="ph ph-x-circle"></i>
        </button>
      </div>
    </div>

    <!-- Certidão de antecedentes criminais -->
    <div class="upload-box">
      <p><strong>Certidão de antecedentes criminais</strong><br>Documento atualizado emitido por órgão oficial (PDF ou imagem, máx. 5MB)</p>
      <label class="upload-btn">
        <i class="ph ph-upload"></i> Fazer Upload
        <input type="file" accept=".pdf,.jpg,.jpeg,.png" id="antecedentes">
      </label>
      <div class="upload-status" id="status-antecedentes"></div>
      <div class="file-preview" id="preview-antecedentes">
        <img class="file-preview-image" id="img-antecedentes" style="display:none;">
        <i class="ph ph-file-pdf file-preview-icon" id="icon-antecedentes"></i>
        <div class="file-preview-info">
          <div class="file-preview-name" id="name-antecedentes"></div>
          <div class="file-preview-size" id="size-antecedentes"></div>
        </div>
        <button class="file-preview-remove" id="remove-antecedentes" type="button">
          <i class="ph ph-x-circle"></i>
        </button>
      </div>
    </div>

    <!-- Foto atual -->
    <div class="upload-box">
      <p><strong>Foto atual</strong><br>Foto recente, nítida, de rosto (imagem, máx. 5MB)</p>
      <label class="upload-btn">
        <i class="ph ph-upload"></i> Fazer Upload
        <input type="file" accept=".jpg,.jpeg,.png" id="foto-atual">
      </label>
      <div class="upload-status" id="status-foto-atual"></div>
      <div class="file-preview" id="preview-foto-atual">
        <img class="file-preview-image" id="img-foto-atual" style="display:none;">
        <i class="ph ph-user-circle file-preview-icon" id="icon-foto-atual"></i>
        <div class="file-preview-info">
          <div class="file-preview-name" id="name-foto-atual"></div>
          <div class="file-preview-size" id="size-foto-atual"></div>
        </div>
        <button class="file-preview-remove" id="remove-foto-atual" type="button">
          <i class="ph ph-x-circle"></i>
        </button>
      </div>
    </div>

    <!-- Registro de classe (opcional) -->
    <div class="upload-box">
      <p><strong>Registro de classe (opcional)</strong><br>CRP, COREN, CRM, CRO ou outro conselho de classe – apenas para profissões regulamentadas (PDF ou imagem, máx. 5MB)</p>
      <label class="upload-btn">
        <i class="ph ph-upload"></i> Fazer Upload
        <input type="file" accept=".pdf,.jpg,.jpeg,.png" id="registro-classe">
      </label>
      <div class="upload-status" id="status-registro-classe"></div>
      <div class="file-preview" id="preview-registro-classe">
        <img class="file-preview-image" id="img-registro-classe" style="display:none;">
        <i class="ph ph-file-pdf file-preview-icon" id="icon-registro-classe"></i>
        <div class="file-preview-info">
          <div class="file-preview-name" id="name-registro-classe"></div>
          <div class="file-preview-size" id="size-registro-classe"></div>
        </div>
        <button class="file-preview-remove" id="remove-registro-classe" type="button">
          <i class="ph ph-x-circle"></i>
        </button>
      </div>
    </div>

    <!-- Botão Finalizar -->
    <button class="continue-btn" id="btn-finalizar">
      <i class="ph ph-check-circle"></i> Finalizar
    </button>

    <!-- Termos -->
    <p class="termos">
      Ao criar uma conta, você concorda com nossos
      <a href="#">Termos de Uso</a> e <a href="#">Políticas de Privacidade</a>
    </p>
  </div>

  <script>
    // Função para formatar tamanho do arquivo
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    // Função para validar arquivo
    function validateFile(file) {
      const maxSize = 5 * 1024 * 1024; // 5MB
      const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
      
      if (file.size > maxSize) {
        return { valid: false, error: 'Arquivo muito grande. Máximo 5MB.' };
      }
      
      if (!allowedTypes.includes(file.type)) {
        return { valid: false, error: 'Tipo de arquivo não permitido.' };
      }
      
      return { valid: true };
    }

    // Função para mostrar preview do arquivo
    function showFilePreview(file, previewId, imgId, iconId, nameId, sizeId, statusId) {
      const validation = validateFile(file);
      const statusEl = document.getElementById(statusId);
      
      if (!validation.valid) {
        statusEl.textContent = validation.error;
        statusEl.className = 'upload-status error';
        return false;
      }
      
      statusEl.textContent = '✓ Arquivo carregado com sucesso!';
      statusEl.className = 'upload-status success';
      
      const preview = document.getElementById(previewId);
      const img = document.getElementById(imgId);
      const icon = document.getElementById(iconId);
      const name = document.getElementById(nameId);
      const size = document.getElementById(sizeId);
      
      preview.classList.add('show');
      name.textContent = file.name;
      size.textContent = formatFileSize(file.size);
      
      // Se for imagem, mostrar preview
      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          img.src = e.target.result;
          img.style.display = 'block';
          icon.style.display = 'none';
        };
        reader.readAsDataURL(file);
      } else {
        img.style.display = 'none';
        icon.style.display = 'block';
      }
      
      return true;
    }

    // Upload RG/CNH
    const rgInput = document.getElementById('rg-cnh');
    let rgFile = null;
    
    rgInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const success = showFilePreview(file, 'preview-rg', 'img-rg', 'icon-rg', 'name-rg', 'size-rg', 'status-rg');
        if (success) {
          rgFile = file;
        } else {
          rgInput.value = '';
        }
      }
    });

    // Remover RG/CNH
    document.getElementById('remove-rg').addEventListener('click', function() {
      rgInput.value = '';
      rgFile = null;
      document.getElementById('preview-rg').classList.remove('show');
      document.getElementById('status-rg').className = 'upload-status';
    });

    // Upload Certificados (múltiplos – pelo menos 1 obrigatório)
    const certificadosInput = document.getElementById('certificados');
    let certificadosFiles = [];
    
    certificadosInput.addEventListener('change', function(e) {
      const files = Array.from(e.target.files || []);
      if (files.length > 0) {
        const first = files[0];
        const success = showFilePreview(first, 'preview-certificados', 'img-certificados', 'icon-certificados', 'name-certificados', 'size-certificados', 'status-certificados');
        if (success) {
          certificadosFiles = files;
        } else {
          certificadosInput.value = '';
          certificadosFiles = [];
        }
      }
    });

    document.getElementById('remove-certificados').addEventListener('click', function() {
      certificadosInput.value = '';
      certificadosFiles = [];
      document.getElementById('preview-certificados').classList.remove('show');
      document.getElementById('status-certificados').className = 'upload-status';
    });

    // Upload Feedback (múltiplos – obrigatório)
    const feedbackInput = document.getElementById('feedback');
    let feedbackFiles = [];
    
    feedbackInput.addEventListener('change', function(e) {
      const files = Array.from(e.target.files || []);
      if (files.length > 0) {
        const first = files[0];
        const success = showFilePreview(first, 'preview-feedback', 'img-feedback', 'icon-feedback', 'name-feedback', 'size-feedback', 'status-feedback');
        if (success) {
          feedbackFiles = files;
        } else {
          feedbackInput.value = '';
          feedbackFiles = [];
        }
      }
    });

    document.getElementById('remove-feedback').addEventListener('click', function() {
      feedbackInput.value = '';
      feedbackFiles = [];
      document.getElementById('preview-feedback').classList.remove('show');
      document.getElementById('status-feedback').className = 'upload-status';
    });

    // Upload Certidão de antecedentes criminais
    const antecedentesInput = document.getElementById('antecedentes');
    let antecedentesFile = null;

    antecedentesInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const success = showFilePreview(file, 'preview-antecedentes', 'img-antecedentes', 'icon-antecedentes', 'name-antecedentes', 'size-antecedentes', 'status-antecedentes');
        if (success) {
          antecedentesFile = file;
        } else {
          antecedentesInput.value = '';
          antecedentesFile = null;
        }
      }
    });

    document.getElementById('remove-antecedentes').addEventListener('click', function() {
      antecedentesInput.value = '';
      antecedentesFile = null;
      document.getElementById('preview-antecedentes').classList.remove('show');
      document.getElementById('status-antecedentes').className = 'upload-status';
    });

    // Upload Foto atual
    const fotoAtualInput = document.getElementById('foto-atual');
    let fotoAtualFile = null;

    fotoAtualInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const success = showFilePreview(file, 'preview-foto-atual', 'img-foto-atual', 'icon-foto-atual', 'name-foto-atual', 'size-foto-atual', 'status-foto-atual');
        if (success) {
          fotoAtualFile = file;
        } else {
          fotoAtualInput.value = '';
          fotoAtualFile = null;
        }
      }
    });

    document.getElementById('remove-foto-atual').addEventListener('click', function() {
      fotoAtualInput.value = '';
      fotoAtualFile = null;
      document.getElementById('preview-foto-atual').classList.remove('show');
      document.getElementById('status-foto-atual').className = 'upload-status';
    });

    // Upload Registro de classe (opcional)
    const registroClasseInput = document.getElementById('registro-classe');
    let registroClasseFile = null;

    registroClasseInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const success = showFilePreview(file, 'preview-registro-classe', 'img-registro-classe', 'icon-registro-classe', 'name-registro-classe', 'size-registro-classe', 'status-registro-classe');
        if (success) {
          registroClasseFile = file;
        } else {
          registroClasseInput.value = '';
          registroClasseFile = null;
        }
      }
    });

    document.getElementById('remove-registro-classe').addEventListener('click', function() {
      registroClasseInput.value = '';
      registroClasseFile = null;
      document.getElementById('preview-registro-classe').classList.remove('show');
      document.getElementById('status-registro-classe').className = 'upload-status';
    });

    // Finalizar cadastro
    document.getElementById('btn-finalizar').addEventListener('click', function() {
      let hasError = false;

      // RG obrigatório
      if (!rgFile) {
        console.warn('[EnviarDocumentos] RG/CNH não enviado');
        document.querySelector('#rg-cnh').closest('.upload-box').style.borderColor = '#f44336';
        hasError = true;
      }

      // Certificados obrigatórios
      if (certificadosFiles.length === 0) {
        console.warn('[EnviarDocumentos] Certificados não enviados');
        document.querySelector('#certificados').closest('.upload-box').style.borderColor = '#f44336';
        hasError = true;
      }

      // Feedbacks obrigatórios
      if (feedbackFiles.length === 0) {
        console.warn('[EnviarDocumentos] Feedbacks não enviados');
        document.querySelector('#feedback').closest('.upload-box').style.borderColor = '#f44336';
        hasError = true;
      }

      // Certidão de antecedentes obrigatória
      if (!antecedentesFile) {
        console.warn('[EnviarDocumentos] Certidão de antecedentes não enviada');
        document.querySelector('#antecedentes').closest('.upload-box').style.borderColor = '#f44336';
        hasError = true;
      }

      // Foto atual obrigatória
      if (!fotoAtualFile) {
        console.warn('[EnviarDocumentos] Foto atual não enviada');
        document.querySelector('#foto-atual').closest('.upload-box').style.borderColor = '#f44336';
        hasError = true;
      }

      if (hasError) {
        setTimeout(() => {
          document.querySelectorAll('.upload-box').forEach(box => box.style.borderColor = '');
        }, 2000);
        return;
      }
      
      // Salvar informação dos documentos no localStorage (somente metadados)
      const userData = JSON.parse(localStorage.getItem('cuidafast_user') || '{}');
      userData.documentos = {
        rgCnh: rgFile ? rgFile.name : null,
        certificados: certificadosFiles.map(f => f.name),
        feedbacks: feedbackFiles.map(f => f.name),
        antecedentesCriminais: antecedentesFile ? antecedentesFile.name : null,
        fotoAtual: fotoAtualFile ? fotoAtualFile.name : null,
        registroClasse: registroClasseFile ? registroClasseFile.name : null,
        dataEnvio: new Date().toISOString()
      };
      userData.cadastroCompleto = true;
      localStorage.setItem('cuidafast_user', JSON.stringify(userData));
      
      console.log('[EnviarDocumentos] Documentos enviados com sucesso', userData.documentos);
      window.location.href = '../HTML/dashboard-cuidador.html';
    });
  </script>
</body>
</html>
